#!/bin/bash
#
# vernhole: Summon random Vern personas for chaotic discovery
#
# Delegates to the Go vern CLI binary. Auto-downloads if not present.
#
# Usage: vernhole [flags] "<idea>"
#
# Flags:
#   --council <name>   Use a named council tier
#   --count <N>        Number of Verns to summon (min 3)
#   --output-dir <dir> Output directory for VernHole files (default: .)
#   --context <file>   Path to context file (e.g. discovery master plan)
#
# Council tiers:
#   hammers  - Council of the Three Hammers (great, mediocre, ketamine)
#   conflict - Max Conflict (startup, enterprise, yolo, paranoid, optimist, inverse)
#   inner    - The Inner Circle (architect, inverse, paranoid + random fill)
#   round    - The Round Table (mighty, yolo, startup, academic, enterprise + random fill)
#   war      - The War Room (all round table + ux, retro, optimist, nyquil + random fill)
#   full     - The Full Vern Experience (all summonable personas)
#   random   - Fate's Hand (random count, random selection)
#

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VERN_CLI="$SCRIPT_DIR/../go/bin/vern"

# Auto-download if Go binary doesn't exist
if [ ! -x "$VERN_CLI" ]; then
    if command -v go &>/dev/null && [ -f "$SCRIPT_DIR/../go/cmd/vern/main.go" ]; then
        echo "[vernhole] Building vern CLI from source..." >&2
        (cd "$SCRIPT_DIR/../go" && go build -o bin/vern ./cmd/vern) 2>/dev/null
    fi
    if [ ! -x "$VERN_CLI" ] && [ -x "$SCRIPT_DIR/install-vern-cli" ]; then
        "$SCRIPT_DIR/install-vern-cli"
    fi
    if [ ! -x "$VERN_CLI" ]; then
        echo "[vernhole] Error: vern CLI not available. Run: cd go && go build -o bin/vern ./cmd/vern" >&2
        exit 1
    fi
fi

exec "$VERN_CLI" hole "$@"
